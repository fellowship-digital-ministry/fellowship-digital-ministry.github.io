---
layout: default
title: Bible Reference Viewer
hero: true
hero_title: Bible Reference Explorer
hero_description: Explore all occurrences of Bible references in sermons with direct links to video timestamps.
custom_js: reference-viewer-simplified
---

<div class="container reference-container">
  <div id="loading-indicator" class="text-center">
    <div class="loading-spinner"></div>
    <p class="loading-text">Loading reference data...</p>
    <div class="progress-container">
      <div class="progress-bar" id="loadingProgress"></div>
    </div>
  </div>
  
  <div id="error-message" class="error-message" style="display: none;"></div>
  
  <div id="reference-details" style="display: none;">
    <div class="reference-header">
      <a href="analytics.html" id="back-button" class="btn btn-sm">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5"></path>
          <path d="M12 19l-7-7 7-7"></path>
        </svg>
        Back to Analytics
      </a>
      
      <div class="reference-title-container">
        <h2 id="reference-title" class="reference-title">Loading...</h2>
        <p class="reference-count">
          Found <span id="reference-count" class="reference-count-number">0</span> occurrences in sermons
        </p>
      </div>
      
      <div class="reference-tools">
        <button id="copyReferenceBtn" class="tool-button" aria-label="Copy reference text">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
          Copy
        </button>
        <button id="shareReferenceBtn" class="tool-button" aria-label="Share this reference">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
          Share
        </button>
      </div>
    </div>
    
    <!-- Reference navigation and filter -->
    <div class="reference-controls">
      <div class="filter-section">
        <label for="sermonFilter" class="filter-label">Filter by sermon:</label>
        <select id="sermonFilter" class="filter-select">
          <option value="all">All Sermons</option>
          <!-- Dynamically populated by JavaScript -->
        </select>
        
        <label for="sortOption" class="filter-label">Sort by:</label>
        <select id="sortOption" class="filter-select">
          <option value="date-desc">Most Recent First</option>
          <option value="date-asc">Oldest First</option>
          <option value="relevance">Relevance</option>
        </select>
      </div>
      
      <div class="view-toggle">
        <span class="toggle-label">View:</span>
        <div class="toggle-buttons">
          <button id="viewList" class="toggle-button active">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
            List
          </button>
          <button id="viewGrid" class="toggle-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
            Grid
          </button>
        </div>
      </div>
    </div>
    
    <!-- Main content with search box -->
    <div class="content-wrapper">
      <div class="search-box">
        <input type="text" id="contextSearch" placeholder="Search within reference contexts..." aria-label="Search within references">
        <button id="clearSearch" class="clear-search" aria-label="Clear search">Ã—</button>
      </div>
      
      <div id="occurrences-list" class="occurrences-list view-list">
        <!-- Loading state for occurrences -->
        <div class="loading-inline">
          <div class="loading-spinner small"></div>
          <p>Loading reference occurrences...</p>
        </div>
        <!-- Dynamically populated by JavaScript -->
      </div>
      
      <div id="no-results" class="no-results" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
        <h3>No occurrences found</h3>
        <p>There are no sermon references matching your current filters.</p>
        <button id="resetFilters" class="btn">Reset Filters</button>
      </div>
    </div>
    
    <div id="related-references-list" class="related-references" style="display: none;">
      <!-- Dynamically populated by JavaScript for related references -->
    </div>
  </div>
  
  <!-- Video Modal -->
  <div id="videoModal" class="modal" hidden>
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="videoModalTitle">Video Segment</h3>
        <button class="close-modal" aria-label="Close video modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="videoContainer" class="video-container">
          <!-- YouTube iframe will be inserted here -->
        </div>
        <div class="reference-context">
          <h4>Reference Context:</h4>
          <div id="videoReferenceContext" class="context-text"></div>
        </div>
        <div class="modal-actions">
          <a id="openYoutubeBtn" class="btn" href="#" target="_blank">
            Open in YouTube
          </a>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Share Modal -->
  <div id="shareModal" class="modal" hidden>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Share Bible Reference</h3>
        <button class="close-modal" aria-label="Close share modal">&times;</button>
      </div>
      <div class="modal-body">
        <p>Share this Bible reference with others:</p>
        <div class="share-url-container">
          <input type="text" id="shareUrl" readonly>
          <button id="copyShareUrl" class="btn">Copy</button>
        </div>
        <div class="share-options">
          <button class="share-button" id="shareEmail">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
            Email
          </button>
          <button class="share-button" id="shareFacebook">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#1877F2"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
            Facebook
          </button>
          <button class="share-button" id="shareTwitter">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#1DA1F2"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
            Twitter
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* Main container */
  .reference-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }
  
  /* Reference header */
  .reference-header {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    margin-bottom: 2rem;
  }
  
  @media (min-width: 768px) {
    .reference-header {
      flex-direction: row;
      align-items: flex-start;
    }
  }
  
  #back-button {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background-color: #f8f9fa;
    border: 1px solid #eee;
    border-radius: 4px;
    color: var(--color-text, #333);
    text-decoration: none;
    transition: transform 0.2s ease, background-color 0.2s ease;
    align-self: flex-start;
  }
  
  #back-button:hover {
    transform: translateX(-3px);
    background-color: #f0f0f0;
  }
  
  .reference-title-container {
    flex: 1;
  }
  
  .reference-title {
    color: var(--color-primary, #2ea3f2);
    margin: 0 0 0.5rem;
    font-size: 2rem;
    font-weight: 700;
  }
  
  .reference-count {
    font-size: 1.1rem;
    color: #666;
    margin: 0;
  }
  
  .reference-count-number {
    font-weight: 600;
    color: var(--color-primary, #2ea3f2);
  }
  
  .reference-tools {
    display: flex;
    gap: 0.75rem;
    align-self: flex-start;
  }
  
  .tool-button {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background-color: #f8f9fa;
    border: 1px solid #eee;
    border-radius: 4px;
    color: var(--color-text, #333);
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  
  .tool-button:hover {
    background-color: #f0f0f0;
  }
  
  /* Reference controls */
  .reference-controls {
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    padding: 1.25rem;
    margin-bottom: 2rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  
  @media (min-width: 768px) {
    .reference-controls {
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
    }
  }
  
  .filter-section {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
  }
  
  .filter-label {
    font-weight: 600;
    font-size: 0.95rem;
    color: var(--color-text, #333);
    white-space: nowrap;
  }
  
  .filter-select {
    padding: 0.5rem;
    border: 1px solid #eee;
    border-radius: 4px;
    min-width: 150px;
  }
  
  .view-toggle {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
  
  .toggle-label {
    font-weight: 600;
    font-size: 0.95rem;
    color: var(--color-text, #333);
  }
  
  .toggle-buttons {
    display: flex;
    border: 1px solid #eee;
    border-radius: 4px;
    overflow: hidden;
  }
  
  .toggle-button {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    background-color: white;
    border: none;
    border-right: 1px solid #eee;
    color: var(--color-text, #333);
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  
  .toggle-button:last-child {
    border-right: none;
  }
  
  .toggle-button.active {
    background-color: var(--color-primary, #2ea3f2);
    color: white;
  }
  
  .toggle-button.active svg {
    color: white;
  }
  
  /* Search box */
  .search-box {
    position: relative;
    margin-bottom: 1.5rem;
  }
  
  .search-box input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.5rem;
    border: 1px solid #eee;
    border-radius: 8px;
    font-size: 1rem;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='18' height='18' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: 0.75rem center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }
  
  .search-box input:focus {
    outline: none;
    border-color: var(--color-primary, #2ea3f2);
    box-shadow: 0 0 0 3px rgba(46, 163, 242, 0.15);
  }
  
  .clear-search {
    position: absolute;
    right: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #666;
    cursor: pointer;
    padding: 0.25rem;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
  }
  
  .clear-search.visible {
    opacity: 1;
    pointer-events: auto;
  }
  
  /* Occurrences list */
  .occurrences-list {
    margin-bottom: 3rem;
  }
  
  /* Sermon group */
  .sermon-group {
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    margin-bottom: 1.5rem;
    overflow: hidden;
    border-left: 4px solid var(--color-primary, #2ea3f2);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  
  .sermon-group:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
  }
  
  .sermon-title {
    padding: 1.25rem;
    margin: 0;
    border-bottom: 1px solid #f0f0f0;
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--color-heading, #333);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .sermon-date {
    font-size: 0.9rem;
    font-weight: normal;
    color: #666;
  }
  
  /* View styles */
  .view-list .occurrence-items {
    display: flex;
    flex-direction: column;
    gap: 0;
  }
  
  .view-grid .occurrence-items {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
    padding: 1rem;
  }
  
  /* Occurrence item */
  .occurrence-item {
    padding: 1.25rem;
    background-color: #fff;
    border-bottom: 1px solid #f0f0f0;
    transition: background-color 0.2s ease;
    cursor: pointer;
  }
  
  .occurrence-item:last-child {
    border-bottom: none;
  }
  
  .occurrence-item:hover {
    background-color: #f9f9f9;
  }
  
  .view-grid .occurrence-item {
    border: 1px solid #f0f0f0;
    border-radius: 6px;
    border-left: 3px solid var(--color-primary, #2ea3f2);
  }
  
  .occurrence-text {
    margin: 0.75rem 0 1.25rem;
    line-height: 1.6;
    color: var(--color-text, #333);
  }
  
  .occurrence-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.9rem;
    color: #777;
  }
  
  .highlight {
    background-color: rgba(46, 163, 242, 0.15);
    font-weight: 600;
    padding: 0 3px;
    border-radius: 3px;
    color: var(--color-heading, #333);
  }
  
  /* No results */
  .no-results {
    text-align: center;
    padding: 3rem 0;
    color: #666;
  }
  
  .no-results h3 {
    margin: 1rem 0 0.5rem;
    color: #444;
  }
  
  /* Loading spinner */
  .loading-spinner {
    border: 4px solid rgba(0, 0, 0, 0.1);
    border-left-color: var(--color-primary, #2ea3f2);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 2rem auto;
  }
  
  .loading-spinner.small {
    width: 24px;
    height: 24px;
    border-width: 3px;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .loading-text {
    margin-bottom: 1rem;
    color: #666;
  }
  
  .progress-container {
    height: 4px;
    width: 80%;
    max-width: 300px;
    background-color: #f0f0f0;
    border-radius: 2px;
    margin: 0 auto 2rem;
    overflow: hidden;
  }
  
  .progress-bar {
    height: 100%;
    width: 0;
    background-color: var(--color-primary, #2ea3f2);
    transition: width 0.4s ease;
  }
  
  /* Modal styles */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }
  
  .modal-content {
    background-color: white;
    border-radius: 10px;
    max-width: 90%;
    width: 700px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  }
  
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid #f0f0f0;
  }
  
  .modal-header h3 {
    margin: 0;
    color: var(--color-heading, #333);
  }
  
  .close-modal {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #666;
  }
  
  .modal-body {
    padding: 1.5rem;
  }
  
  /* Video container */
  .video-container {
    position: relative;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
    height: 0;
    overflow: hidden;
    margin-bottom: 1.5rem;
  }
  
  .video-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
    border-radius: 6px;
  }
  
  .reference-context {
    margin-top: 1.5rem;
    padding-top: 1rem;
    border-top: 1px solid #f0f0f0;
  }
  
  .reference-context h4 {
    margin-top: 0;
    margin-bottom: 0.75rem;
    color: var(--color-heading, #333);
  }
  
  .context-text {
    background-color: #f8f9fa;
    padding: 1rem;
    border-radius: 6px;
    line-height: 1.6;
    color: var(--color-text, #333);
  }
  
  /* Modal actions */
  .modal-actions {
    margin-top: 1.5rem;
    display: flex;
    justify-content: flex-end;
  }
  
  /* Share modal */
  .share-url-container {
    display: flex;
    margin-bottom: 1.5rem;
  }
  
  .share-url-container input {
    flex: 1;
    padding: 0.75rem;
    border: 1px solid #eee;
    border-right: none;
    border-radius: 4px 0 0 4px;
    font-size: 1rem;
    background-color: #f8f9fa;
  }
  
  .share-url-container button {
    padding: 0.75rem 1.5rem;
    background-color: var(--color-primary, #2ea3f2);
    color: white;
    border: none;
    border-radius: 0 4px 4px 0;
    font-weight: 600;
    cursor: pointer;
  }
  
  .share-options {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .share-button {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem;
    background-color: #f8f9fa;
    border: 1px solid #eee;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    width: 90px;
  }
  
  .share-button:hover {
    transform: translateY(-3px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
  }
  
  /* Button styles */
  .btn {
    padding: 0.5rem 1rem;
    background-color: var(--color-primary, #2ea3f2);
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s ease;
    text-decoration: none;
    display: inline-block;
    text-align: center;
  }
  
  .btn:hover {
    background-color: #2179c3;
  }
  
  .btn-sm {
    padding: 0.35rem 0.75rem;
    font-size: 0.9rem;
  }
  
  /* Responsive adjustments */
  @media (max-width: 767px) {
    .reference-tools {
      margin-top: 1rem;
    }
    
    .filter-section {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .filter-select {
      width: 100%;
    }
    
    .sermon-title {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .sermon-date {
      margin-top: 0.5rem;
    }
    
    .view-grid .occurrence-items {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
// Helper functions for modals
function closeModal(modal) {
  if (!modal) return;
  
  modal.hidden = true;
  
  // If it's the video modal, clear the video to stop playback
  if (modal.id === 'videoModal') {
    const videoContainer = document.getElementById('videoContainer');
    if (videoContainer) {
      videoContainer.innerHTML = '';
    }
  }
}

function openModal(modal) {
  if (!modal) return;
  modal.hidden = false;
}

function openShareModal() {
  const shareModal = document.getElementById('shareModal');
  const shareUrl = document.getElementById('shareUrl');
  
  if (shareModal && shareUrl) {
    // Set the current URL as the share URL
    shareUrl.value = window.location.href;
    
    // Open the modal
    openModal(shareModal);
    
    // Select the URL text
    setTimeout(() => {
      shareUrl.select();
    }, 100);
  }
}

function copyReferenceToClipboard() {
  const referenceTitle = document.getElementById('reference-title');
  
  if (referenceTitle) {
    // Create a temporary textarea to copy from
    const textarea = document.createElement('textarea');
    textarea.value = referenceTitle.textContent;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    
    // Change button text to show success
    const copyButton = document.getElementById('copyReferenceBtn');
    if (copyButton) {
      const originalHTML = copyButton.innerHTML;
      copyButton.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
        Copied
      `;
      
      // Reset after 2 seconds
      setTimeout(() => {
        copyButton.innerHTML = originalHTML;
      }, 2000);
    }
  }
}

// Mock data functions
function initializeReferenceData() {
  // Parse URL parameters
  const urlParams = new URLSearchParams(window.location.search);
  const reference = urlParams.get('reference') || 'John 3:16';
  
  // Update page title
  document.title = `${reference} - Bible Reference Viewer`;
  
  // Update reference title and count
  document.getElementById('reference-title').textContent = reference;
  document.getElementById('reference-count').textContent = '12';
  
  // Generate sample data (in a real app, this would come from an API)
  const sermons = [
    {
      id: 1,
      title: 'The Gospel Message',
      date: 'May 2, 2025',
      occurrences: [
        {
          text: "And here we see in <span class='highlight'>John 3:16</span>, \"For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life.\" This is the essence of the gospel message, the heart of our faith.",
          timestamp: '14:23',
          videoId: 'dQw4w9WgXcQ'
        },
        {
          text: "Later in the sermon, we return to <span class='highlight'>John 3:16</span> to understand the depth of God's love. This verse shows us that God's love is universal - 'the world' - and also deeply personal.",
          timestamp: '32:45',
          videoId: 'dQw4w9WgXcQ'
        }
      ]
    },
    {
      id: 2,
      title: 'Understanding God\'s Love',
      date: 'April 23, 2025',
      occurrences: [
        {
          text: "There is no greater verse to understand the love of God than <span class='highlight'>John 3:16</span>. This verse encapsulates the entirety of the gospel in a single sentence.",
          timestamp: '8:17',
          videoId: 'dQw4w9WgXcQ'
        }
      ]
    },
    {
      id: 3,
      title: 'Salvation by Faith Alone',
      date: 'April 15, 2025',
      occurrences: [
        {
          text: "We see in <span class='highlight'>John 3:16</span> that salvation comes through belief - 'whoever believes in him shall not perish but have eternal life.' This aligns perfectly with our understanding of salvation by faith alone.",
          timestamp: '19:52',
          videoId: 'dQw4w9WgXcQ'
        },
        {
          text: "When we compare <span class='highlight'>John 3:16</span> with Ephesians 2:8-9, we see the consistent message that salvation is a gift received through faith, not earned through works.",
          timestamp: '27:31',
          videoId: 'dQw4w9WgXcQ'
        },
        {
          text: "The universal offer in <span class='highlight'>John 3:16</span> - 'whoever believes' - shows that salvation is available to all who put their faith in Christ, regardless of background, past sins, or present circumstances.",
          timestamp: '42:05',
          videoId: 'dQw4w9WgXcQ'
        }
      ]
    },
    {
      id: 4,
      title: 'The Trinity in Scripture',
      date: 'March 28, 2025',
      occurrences: [
        {
          text: "In <span class='highlight'>John 3:16</span>, we see two persons of the Trinity explicitly mentioned - God the Father who loved and gave, and God the Son who was given for our salvation.",
          timestamp: '23:14',
          videoId: 'dQw4w9WgXcQ'
        }
      ]
    },
    {
      id: 5,
      title: 'Eternal Life: Understanding Heaven',
      date: 'March 15, 2025',
      occurrences: [
        {
          text: "<span class='highlight'>John 3:16</span> promises 'eternal life' to believers. This is not just about duration of life, but a quality of life - God's own life shared with us forever.",
          timestamp: '11:38',
          videoId: 'dQw4w9WgXcQ'
        },
        {
          text: "The contrast in <span class='highlight'>John 3:16</span> between 'perish' and 'eternal life' helps us understand the stakes of faith. These are the two ultimate destinations of humanity.",
          timestamp: '29:54',
          videoId: 'dQw4w9WgXcQ'
        }
      ]
    }
  ];
  
  // Populate sermon filter
  populateSermonFilter(sermons);
  
  // Render occurrences
  renderOccurrences(sermons);
  
  // Generate related references
  generateRelatedReferences(reference);
}

function populateSermonFilter(sermons) {
  const sermonFilter = document.getElementById('sermonFilter');
  
  if (sermonFilter) {
    // Clear existing options except "All Sermons"
    while (sermonFilter.options.length > 1) {
      sermonFilter.remove(1);
    }
    
    // Add sermon options
    sermons.forEach(sermon => {
      const option = document.createElement('option');
      option.value = sermon.id;
      option.textContent = sermon.title;
      sermonFilter.appendChild(option);
    });
  }
}

function renderOccurrences(sermons) {
  const occurrencesList = document.getElementById('occurrences-list');
  
  if (occurrencesList) {
    // Clear loading state
    occurrencesList.innerHTML = '';
    
    // Add sermon groups
    sermons.forEach(sermon => {
      const sermonGroup = document.createElement('div');
      sermonGroup.className = 'sermon-group';
      sermonGroup.setAttribute('data-sermon-id', sermon.id);
      
      // Add sermon title
      const titleElement = document.createElement('h3');
      titleElement.className = 'sermon-title';
      titleElement.innerHTML = `${sermon.title} <span class="sermon-date">${sermon.date}</span>`;
      
      // Add occurrences
      const occurrencesContainer = document.createElement('div');
      occurrencesContainer.className = 'occurrence-items';
      
      sermon.occurrences.forEach(occurrence => {
        const occurrenceItem = document.createElement('div');
        occurrenceItem.className = 'occurrence-item';
        occurrenceItem.setAttribute('data-video-id', occurrence.videoId);
        occurrenceItem.setAttribute('data-timestamp', occurrence.timestamp);
        
        occurrenceItem.innerHTML = `
          <div class="occurrence-text">${occurrence.text}</div>
          <div class="occurrence-meta">
            <div class="timestamp">Timestamp: ${occurrence.timestamp}</div>
            <div class="video-link">Watch Video</div>
          </div>
        `;
        
        // Add click event to play video
        occurrenceItem.addEventListener('click', function() {
          openVideoModal(this.getAttribute('data-video-id'), this.getAttribute('data-timestamp'), sermon.title, occurrence.text);
        });
        
        occurrencesContainer.appendChild(occurrenceItem);
      });
      
      sermonGroup.appendChild(titleElement);
      sermonGroup.appendChild(occurrencesContainer);
      occurrencesList.appendChild(sermonGroup);
    });
  }
}

function openVideoModal(videoId, timestamp, sermonTitle, context) {
  const videoModal = document.getElementById('videoModal');
  const videoContainer = document.getElementById('videoContainer');
  const videoModalTitle = document.getElementById('videoModalTitle');
  const videoReferenceContext = document.getElementById('videoReferenceContext');
  const openYoutubeBtn = document.getElementById('openYoutubeBtn');
  
  if (videoModal && videoContainer && videoModalTitle && videoReferenceContext && openYoutubeBtn) {
    // Convert timestamp (MM:SS) to seconds
    let startSeconds = 0;
    if (timestamp.includes(':')) {
      const parts = timestamp.split(':');
      startSeconds = parseInt(parts[0]) * 60 + parseInt(parts[1]);
    } else {
      startSeconds = parseInt(timestamp);
    }
    
    // Update modal title
    videoModalTitle.textContent = `${sermonTitle} - ${timestamp}`;
    
    // Update context
    videoReferenceContext.innerHTML = context;
    
    // Update YouTube button link
    openYoutubeBtn.href = `https://www.youtube.com/watch?v=${videoId}&t=${startSeconds}`;
    
    // Create YouTube embed
    videoContainer.innerHTML = `
      <iframe 
        src="https://www.youtube.com/embed/${videoId}?start=${startSeconds}&autoplay=1" 
        frameborder="0" 
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
        allowfullscreen
        title="Sermon video at timestamp ${timestamp}">
      </iframe>
    `;
    
    // Open modal
    openModal(videoModal);
  }
}

function generateRelatedReferences(reference) {
  // Extract book and chapter from the reference
  let book = '';
  let chapter = '';
  
  // Simple regex to extract book and chapter (e.g., "John 3:16" -> book="John", chapter="3")
  const match = reference.match(/^(\d*\s*[A-Za-z]+)\s*(\d+)(?::\d+(?:-\d+)?)?$/);
  
  if (match) {
    book = match[1];
    chapter = match[2];
    
    // Generate related references based on same chapter
    const relatedReferences = [
      { reference: `${book} ${chapter}:1-5`, count: 8 },
      { reference: `${book} ${chapter}:14-17`, count: 15 },
      { reference: `${book} ${chapter}:36`, count: 6 },
      { reference: `${book} ${chapter}`, count: 24 },
      { reference: `${book} ${parseInt(chapter) + 1}:1-3`, count: 5 }
    ];
    
    // Display related references
    const relatedReferencesContainer = document.getElementById('related-references-list');
    
    if (relatedReferencesContainer) {
      relatedReferencesContainer.innerHTML = `
        <h3 class="section-header">Related References</h3>
        <div class="reference-list">
          ${relatedReferences.map(ref => `
            <div class="reference-item" onclick="window.location.href='reference-viewer.html?reference=${encodeURIComponent(ref.reference)}'">
              <span class="reference-name">${ref.reference}</span>
              <span class="reference-count">${ref.count}</span>
            </div>
          `).join('')}
        </div>
      `;
      
      relatedReferencesContainer.style.display = 'block';
    }
  }
}

function filterOccurrences() {
  const sermonFilter = document.getElementById('sermonFilter');
  const sermonGroups = document.querySelectorAll('.sermon-group');
  
  if (sermonFilter && sermonGroups.length > 0) {
    const selectedSermonId = sermonFilter.value;
    
    if (selectedSermonId === 'all') {
      // Show all sermon groups
      sermonGroups.forEach(group => {
        group.style.display = '';
      });
    } else {
      // Show only the selected sermon group
      sermonGroups.forEach(group => {
        if (group.getAttribute('data-sermon-id') === selectedSermonId) {
          group.style.display = '';
        } else {
          group.style.display = 'none';
        }
      });
    }
    
    // Check if any groups are visible
    let visibleGroups = 0;
    sermonGroups.forEach(group => {
      if (group.style.display !== 'none') {
        visibleGroups++;
      }
    });
    
    // Show/hide "no results" message
    const noResultsElement = document.getElementById('no-results');
    if (noResultsElement) {
      noResultsElement.hidden = visibleGroups > 0;
    }
  }
}

function sortOccurrences(sortValue) {
  const occurrencesList = document.getElementById('occurrences-list');
  const sermonGroups = Array.from(document.querySelectorAll('.sermon-group'));
  
  if (occurrencesList && sermonGroups.length > 0) {
    // Sort based on the selected option
    switch (sortValue) {
      case 'date-desc': // Most recent first
        sermonGroups.sort((a, b) => {
          const dateA = a.querySelector('.sermon-date').textContent;
          const dateB = b.querySelector('.sermon-date').textContent;
          return new Date(dateB) - new Date(dateA);
        });
        break;
        
      case 'date-asc': // Oldest first
        sermonGroups.sort((a, b) => {
          const dateA = a.querySelector('.sermon-date').textContent;
          const dateB = b.querySelector('.sermon-date').textContent;
          return new Date(dateA) - new Date(dateB);
        });
        break;
        
      case 'relevance': // Sort by number of occurrences
        sermonGroups.sort((a, b) => {
          const countA = a.querySelectorAll('.occurrence-item').length;
          const countB = b.querySelectorAll('.occurrence-item').length;
          return countB - countA;
        });
        break;
    }
    
    // Re-append in the new order
    sermonGroups.forEach(group => {
      occurrencesList.appendChild(group);
    });
  }
}

function searchInOccurrences(query) {
  if (!query) {
    resetSearch();
    return;
  }
  
  query = query.toLowerCase();
  
  const occurrenceItems = document.querySelectorAll('.occurrence-item');
  const sermonGroups = document.querySelectorAll('.sermon-group');
  
  let foundAny = false;
  
  // Search in each occurrence item
  occurrenceItems.forEach(item => {
    const textElement = item.querySelector('.occurrence-text');
    if (textElement) {
      const text = textElement.textContent.toLowerCase();
      
      if (text.includes(query)) {
        // Show this item
        item.style.display = '';
        foundAny = true;
        
        // Highlight the matching text
        const originalText = textElement.innerHTML;
        const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
        textElement.innerHTML = originalText.replace(regex, '<mark>$1</mark>');
      } else {
        // Hide this item
        item.style.display = 'none';
      }
    }
  });
  
  // Show/hide sermon groups based on visible items
  sermonGroups.forEach(group => {
    const visibleItems = Array.from(group.querySelectorAll('.occurrence-item')).filter(item => {
      return item.style.display !== 'none';
    });
    
    group.style.display = visibleItems.length > 0 ? '' : 'none';
  });
  
  // Show/hide "no results" message
  const noResultsElement = document.getElementById('no-results');
  if (noResultsElement) {
    noResultsElement.hidden = foundAny;
  }
}

function resetSearch() {
  const occurrenceItems = document.querySelectorAll('.occurrence-item');
  const sermonGroups = document.querySelectorAll('.sermon-group');
  const noResultsElement = document.getElementById('no-results');
  
  // Show all items
  occurrenceItems.forEach(item => {
    item.style.display = '';
    
    // Remove highlights
    const textElement = item.querySelector('.occurrence-text');
    if (textElement) {
      textElement.innerHTML = textElement.innerHTML.replace(/<mark>(.*?)<\/mark>/g, '$1');
    }
  });
  
  // Show all groups
  sermonGroups.forEach(group => {
    group.style.display = '';
  });
  
  // Hide "no results" message
  if (noResultsElement) {
    noResultsElement.hidden = true;
  }
}

function resetAllFilters() {
  // Reset sermon filter
  const sermonFilter = document.getElementById('sermonFilter');
  if (sermonFilter) {
    sermonFilter.value = 'all';
  }
  
  // Reset sort option
  const sortOption = document.getElementById('sortOption');
  if (sortOption) {
    sortOption.value = 'date-desc';
  }
  
  // Reset search
  const searchInput = document.getElementById('contextSearch');
  const clearSearch = document.getElementById('clearSearch');
  if (searchInput) {
    searchInput.value = '';
  }
  if (clearSearch) {
    clearSearch.classList.remove('visible');
  }
  
  // Apply reset
  resetSearch();
  filterOccurrences();
  sortOccurrences('date-desc');
}

// Initialize event listeners when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  // Simulate loading progress
  const progressBar = document.getElementById('loadingProgress');
  let progress = 0;
  const progressInterval = setInterval(() => {
    progress += 5;
    if (progressBar) progressBar.style.width = `${progress}%`;
    if (progress >= 100) {
      clearInterval(progressInterval);
      setTimeout(() => {
        // Hide loading, show content
        document.getElementById('loading-indicator').style.display = 'none';
        document.getElementById('reference-details').style.display = 'block';
        // Initialize data
        initializeReferenceData();
      }, 300);
    }
  }, 100);
  
  // Initialize event listeners
  initEventListeners();
});

function initEventListeners() {
  // Toggle view buttons
  const viewList = document.getElementById('viewList');
  const viewGrid = document.getElementById('viewGrid');
  const occurrencesList = document.getElementById('occurrences-list');
  
  if (viewList && viewGrid && occurrencesList) {
    viewList.addEventListener('click', function() {
      occurrencesList.classList.remove('view-grid');
      occurrencesList.classList.add('view-list');
      viewList.classList.add('active');
      viewGrid.classList.remove('active');
    });
    
    viewGrid.addEventListener('click', function() {
      occurrencesList.classList.remove('view-list');
      occurrencesList.classList.add('view-grid');
      viewGrid.classList.add('active');
      viewList.classList.remove('active');
    });
  }
  
  // Sermon filter
  const sermonFilter = document.getElementById('sermonFilter');
  if (sermonFilter) {
    sermonFilter.addEventListener('change', function() {
      filterOccurrences();
    });
  }
  
  // Sort options
  const sortOption = document.getElementById('sortOption');
  if (sortOption) {
    sortOption.addEventListener('change', function() {
      sortOccurrences(this.value);
    });
  }
  
  // Search functionality
  const searchInput = document.getElementById('contextSearch');
  const clearSearch = document.getElementById('clearSearch');
  
  if (searchInput && clearSearch) {
    searchInput.addEventListener('input', function() {
      if (this.value.length > 0) {
        clearSearch.classList.add('visible');
      } else {
        clearSearch.classList.remove('visible');
      }
      searchInOccurrences(this.value);
    });
    
    clearSearch.addEventListener('click', function() {
      searchInput.value = '';
      this.classList.remove('visible');
      resetSearch();
      searchInput.focus();
    });
  }
  
  // Reset filters button
  const resetFilters = document.getElementById('resetFilters');
  if (resetFilters) {
    resetFilters.addEventListener('click', function() {
      resetAllFilters();
    });
  }
  
  // Copy reference button
  const copyReferenceBtn = document.getElementById('copyReferenceBtn');
  if (copyReferenceBtn) {
    copyReferenceBtn.addEventListener('click', function() {
      copyReferenceToClipboard();
    });
  }
  
  // Share reference button
  const shareReferenceBtn = document.getElementById('shareReferenceBtn');
  if (shareReferenceBtn) {
    shareReferenceBtn.addEventListener('click', function() {
      openShareModal();
    });
  }
  
  // Modal close buttons
  const closeModalButtons = document.querySelectorAll('.close-modal');
  closeModalButtons.forEach(button => {
    button.addEventListener('click', function() {
      const modal = this.closest('.modal');
      if (modal) {
        closeModal(modal);
      }
    });
  });
  
  // Copy share URL button
  const copyShareUrlBtn = document.getElementById('copyShareUrl');
  if (copyShareUrlBtn) {
    copyShareUrlBtn.addEventListener('click', function() {
      const shareUrl = document.getElementById('shareUrl');
      if (shareUrl) {
        shareUrl.select();
        document.execCommand('copy');
        this.textContent = 'Copied!';
        setTimeout(() => {
          this.textContent = 'Copy';
        }, 2000);
      }
    });
  }
  
  // Share via email, Facebook, Twitter
  const shareEmailBtn = document.getElementById('shareEmail');
  const shareFacebookBtn = document.getElementById('shareFacebook');
  const shareTwitterBtn = document.getElementById('shareTwitter');
  
  if (shareEmailBtn) {
    shareEmailBtn.addEventListener('click', function() {
      const url = document.getElementById('shareUrl').value;
      const title = document.getElementById('reference-title').textContent;
      window.location.href = `mailto:?subject=Bible Reference: ${title}&body=Check out this Bible reference: ${url}`;
    });
  }
  
  if (shareFacebookBtn) {
    shareFacebookBtn.addEventListener('click', function() {
      const url = encodeURIComponent(document.getElementById('shareUrl').value);
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, 'facebook-share', 'width=580,height=520');
    });
  }
  
  if (shareTwitterBtn) {
    shareTwitterBtn.addEventListener('click', function() {
      const url = encodeURIComponent(document.getElementById('shareUrl').value);
      const title = encodeURIComponent(document.getElementById('reference-title').textContent);
      window.open(`https://twitter.com/intent/tweet?text=${title}&url=${url}`, 'twitter-share', 'width=550,height=420');
    });
  }
  
  // Close modals when clicking backdrop
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('modal')) {
      closeModal(e.target);
    }
  });
  
  // Close modals with Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      const openModals = document.querySelectorAll('.modal:not([hidden])');
      openModals.forEach(modal => {
        closeModal(modal);
      });
    }
  });
}
</script>