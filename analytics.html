---
layout: default
title: Sermon Analytics
use_charts: true
---

<div class="container analytics-container">
  <div id="loadingSection" class="text-center">
    <div class="loading-spinner"></div>
    <p class="loading-text">Loading analytics data...</p>
    <div class="progress-container">
      <div class="progress-bar" id="loadingProgress"></div>
    </div>
  </div>
  
  <div id="analyticsContent" style="display: none;">
    <!-- Page Introduction -->
    <div class="page-intro">
      <h2 class="section-header">Bible Reference Analytics</h2>
      <p>This dashboard visualizes Bible references across our sermon library. Explore which books, chapters, and verses are most frequently referenced in our pastor's teachings.</p>
    </div>
    
    <!-- Time Filter -->
    <div class="filter-controls">
      <div class="content-card">
        <h3>Filter by Time Period</h3>
        <div class="filter-form-group">
          <label for="timeFilterSelect">Time period:</label>
          <select id="timeFilterSelect" class="form-control">
            <option value="all">All Time</option>
            <!-- Dynamically populated by JavaScript -->
          </select>
        </div>
      </div>
    </div>
    
    <!-- Key Statistics -->
    <h2 class="section-header" id="keyStatsHeading">Key Statistics</h2>
    <div class="stats-cards">
      <div class="stat-card" tabindex="0">
        <div class="stat-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"></path><path d="M18 20V4"></path><path d="M6 20v-4"></path></svg>
        </div>
        <div class="stat-value" id="totalSermonsValue">...</div>
        <div class="stat-label">Total Sermons</div>
      </div>
      <div class="stat-card" tabindex="0">
        <div class="stat-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1-2.5-2.5z"></path><path d="M8 7h6"></path><path d="M8 11h8"></path><path d="M8 15h6"></path></svg>
        </div>
        <div class="stat-value" id="totalReferencesValue">...</div>
        <div class="stat-label">Bible References</div>
      </div>
      <div class="stat-card" tabindex="0">
        <div class="stat-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8l5 5 5-5"></path><path d="M12 16l5-5 5 5"></path><path d="M2 12h20"></path></svg>
        </div>
        <div class="stat-value" id="topBookValue">...</div>
        <div class="stat-label">Most Referenced Book</div>
      </div>
    </div>
    
    <!-- Bible Books Chart -->
    <h2 class="section-header" id="booksChartHeading">Bible Book References</h2>
    <div class="analytics-card">
      <h3>Frequency of Bible Book Citations</h3>
      <p class="analytics-description">Explore which books of the Bible are most frequently referenced across all sermons. Click on any bar to see detailed references for that book.</p>
      <div class="chart-container">
        <canvas id="bibleReferencesChart"></canvas>
      </div>
      <p class="chart-instruction">Click on any book bar to view detailed references.</p>
      <div class="chart-data-table-toggle">
        <button id="showChartDataTable" class="btn btn-sm">View as Data Table</button>
      </div>
      <div id="chartDataTable" class="chart-data-table" hidden>
        <h4>Bible Books by Reference Count</h4>
        <table class="data-table">
          <caption>Frequency of Bible book citations in sermons</caption>
          <thead>
            <tr>
              <th>Book</th>
              <th>References</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="bookDataTableBody">
            <!-- Populated by JavaScript -->
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Testament & Chapters Section -->
    <h2 class="section-header" id="detailedAnalysisHeading">Detailed Reference Analysis</h2>
    <div class="analytics-grid">
      <div class="analytics-card">
        <h3>Testament Distribution</h3>
        <p class="analytics-description">Proportion of Old vs. New Testament references in the sermon library.</p>
        <div class="chart-container">
          <canvas id="testamentChart"></canvas>
        </div>
        <div id="testamentPercentages" class="chart-summary"></div>
      </div>
      <div class="analytics-card">
        <h3>Top Chapters Referenced</h3>
        <p class="analytics-description">Most frequently cited Bible chapters across the sermon library. Click on any chapter to see all occurrences.</p>
        <div id="topChaptersContainer">
          <div class="reference-list" id="topChaptersList">
            <!-- Populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>
    
    <!-- Actions & YouTube Link Section -->
    <div class="actions-section">
      <h3>Additional Resources</h3>
      <div class="action-buttons">
        <a href="reference-viewer.html" class="action-button">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
          Browse All References
        </a>
        <button id="downloadCSV" class="action-button">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
          Download CSV Data
        </button>
        <a href="https://www.youtube.com/c/FellowshipBaptistChurch" target="_blank" class="action-button youtube-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg>
          Visit YouTube Channel
        </a>
      </div>
    </div>
  </div>
  
  <!-- Error Section -->
  <div id="errorSection" style="display: none;">
    <div class="analytics-card text-center">
      <div class="error-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
      </div>
      <h2>Error Loading Data</h2>
      <p id="errorMessage">Sorry, there was an error loading the analytics data. Please try again later.</p>
      <button id="retryButton" class="btn btn-primary">Retry</button>
    </div>
  </div>
</div>

<style>
  /* Core styles for the analytics page */
  .analytics-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }
  
  .section-header {
    margin: 2rem 0 1rem;
    color: var(--color-primary, #2ea3f2);
    font-size: 1.75rem;
    font-weight: 600;
    position: relative;
    padding-bottom: 0.5rem;
  }
  
  .section-header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 50px;
    height: 3px;
    background-color: var(--color-primary, #2ea3f2);
  }
  
  .page-intro {
    margin-bottom: 2rem;
  }
  
  /* Stats cards */
  .stats-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }
  
  .stat-card {
    background-color: white;
    border-radius: 10px;
    padding: 1.5rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    text-align: center;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  
  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.09);
  }
  
  .stat-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    margin-bottom: 1rem;
    background-color: rgba(46, 163, 242, 0.1);
    color: var(--color-primary, #2ea3f2);
  }
  
  .stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: var(--color-heading, #333);
  }
  
  .stat-label {
    font-size: 1rem;
    color: #666;
  }
  
  /* Analytics cards */
  .analytics-card {
    background-color: white;
    border-radius: 10px;
    padding: 1.5rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    margin-bottom: 2rem;
  }
  
  .analytics-card h3 {
    margin-top: 0;
    margin-bottom: 0.75rem;
    color: var(--color-heading, #333);
  }
  
  .analytics-description {
    color: #666;
    margin-bottom: 1.5rem;
  }
  
  /* Chart container */
  .chart-container {
    height: 400px;
    position: relative;
    margin-bottom: 1.5rem;
  }
  
  .chart-instruction {
    text-align: center;
    font-size: 0.9rem;
    color: #666;
    margin-top: 1rem;
  }
  
  /* Grid layout for detailed analysis */
  .analytics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }
  
  /* Reference list styling */
  .reference-list {
    max-height: 350px;
    overflow-y: auto;
    border: 1px solid #f0f0f0;
    border-radius: 6px;
  }
  
  .reference-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #f0f0f0;
    transition: background-color 0.2s ease;
  }
  
  .reference-item:last-child {
    border-bottom: none;
  }
  
  .reference-item:hover {
    background-color: #f9f9f9;
  }
  
  .reference-name {
    font-weight: 500;
    color: var(--color-heading, #333);
  }
  
  .reference-count {
    background-color: var(--color-primary, #2ea3f2);
    color: white;
    border-radius: 20px;
    padding: 0.25rem 0.75rem;
    font-size: 0.9rem;
    font-weight: 500;
  }
  
  /* Chart data table */
  .chart-data-table-toggle {
    text-align: center;
    margin-top: 1rem;
  }
  
  .data-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
  }
  
  .data-table th, 
  .data-table td {
    padding: 0.75rem;
    border: 1px solid #eee;
    text-align: left;
  }
  
  .data-table th {
    background-color: #f8f9fa;
    font-weight: 600;
  }
  
  .data-table tr:hover {
    background-color: #f9f9f9;
  }
  
  /* Actions section */
  .actions-section {
    background-color: #f8f9fa;
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 2rem;
  }
  
  .action-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .action-button {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1.25rem;
    background-color: white;
    border: 1px solid #eee;
    border-radius: 8px;
    color: var(--color-text, #333);
    text-decoration: none;
    transition: all 0.2s ease;
    cursor: pointer;
    font-weight: 500;
  }
  
  .action-button:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  
  .action-button svg {
    color: var(--color-primary, #2ea3f2);
  }
  
  .youtube-link {
    background-color: #f9f9f9;
  }
  
  .youtube-link svg {
    color: #ff0000;
  }
  
  /* Loading spinner and error section */
  .loading-spinner {
    border: 4px solid rgba(0, 0, 0, 0.1);
    border-left-color: var(--color-primary, #2ea3f2);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 2rem auto;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .loading-text {
    margin-bottom: 1rem;
    color: #666;
  }
  
  .progress-container {
    height: 4px;
    width: 80%;
    max-width: 300px;
    background-color: #f0f0f0;
    border-radius: 2px;
    margin: 0 auto 2rem;
    overflow: hidden;
  }
  
  .progress-bar {
    height: 100%;
    width: 0;
    background-color: var(--color-primary, #2ea3f2);
    transition: width 0.4s ease;
  }
  
  .error-icon {
    color: #d32f2f;
    margin-bottom: 1rem;
  }
  
  /* Responsive adjustments */
  @media (max-width: 767px) {
    .stats-cards {
      grid-template-columns: 1fr;
    }
    
    .analytics-grid {
      grid-template-columns: 1fr;
    }
    
    .action-buttons {
      flex-direction: column;
    }
    
    .action-button {
      width: 100%;
    }
    
    .chart-container {
      height: 300px;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Simulate loading progress
  const progressBar = document.getElementById('loadingProgress');
  let progress = 0;
  const progressInterval = setInterval(() => {
    progress += 5;
    if (progressBar) progressBar.style.width = `${progress}%`;
    if (progress >= 100) {
      clearInterval(progressInterval);
      // Hide loading, show content
      document.getElementById('loadingSection').style.display = 'none';
      document.getElementById('analyticsContent').style.display = 'block';
      // Initialize charts
      initCharts();
    }
  }, 100);
  
  // Initialize data table toggle
  const showTableButton = document.getElementById('showChartDataTable');
  const chartDataTable = document.getElementById('chartDataTable');
  
  if (showTableButton && chartDataTable) {
    showTableButton.addEventListener('click', function() {
      const isHidden = chartDataTable.hidden;
      chartDataTable.hidden = !isHidden;
      this.textContent = isHidden ? 'Hide Data Table' : 'View as Data Table';
    });
  }
  
  // Initialize retry button
  const retryButton = document.getElementById('retryButton');
  if (retryButton) {
    retryButton.addEventListener('click', function() {
      document.getElementById('errorSection').style.display = 'none';
      document.getElementById('loadingSection').style.display = 'block';
      progress = 0;
      // Restart loading process
      progressInterval = setInterval(() => {
        progress += 5;
        if (progressBar) progressBar.style.width = `${progress}%`;
        if (progress >= 100) {
          clearInterval(progressInterval);
          document.getElementById('loadingSection').style.display = 'none';
          document.getElementById('analyticsContent').style.display = 'block';
          initCharts();
        }
      }, 100);
    });
  }
  
  // Initialize download CSV
  const downloadButton = document.getElementById('downloadCSV');
  if (downloadButton) {
    downloadButton.addEventListener('click', function() {
      // Sample data for demonstration
      const csv = 'Book,References\nMatthew,257\nJohn,189\nRomans,165\nPsalms,143\nGenesis,102';
      
      // Create blob and download
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', 'bible_references.csv');
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });
  }
});

function initCharts() {
  // Sample data - would be replaced with real data in production
  const booksData = {
    labels: ['Matthew', 'John', 'Romans', 'Psalms', 'Genesis', 'Revelation', 'Acts', 'Isaiah', 'Luke', 'Ephesians'],
    values: [257, 189, 165, 143, 102, 98, 87, 76, 72, 68]
  };
  
  const testamentData = {
    labels: ['New Testament', 'Old Testament'],
    values: [65, 35]
  };
  
  const topChapters = [
    { name: 'John 3', count: 42 },
    { name: 'Romans 8', count: 38 },
    { name: 'Matthew 5', count: 34 },
    { name: 'Ephesians 2', count: 29 },
    { name: 'Psalms 23', count: 27 },
    { name: 'Genesis 1', count: 25 },
    { name: 'Revelation 21', count: 23 },
    { name: 'John 1', count: 21 },
    { name: 'Romans 12', count: 19 },
    { name: 'Hebrews 11', count: 17 }
  ];
  
  // Update statistics
  document.getElementById('totalSermonsValue').textContent = '523';
  document.getElementById('totalReferencesValue').textContent = '3,841';
  document.getElementById('topBookValue').textContent = 'Matthew';
  
  // Testament percentages
  document.getElementById('testamentPercentages').innerHTML = `
    <div><span style="color: #4e73df; font-weight: 600;">New Testament:</span> 65%</div>
    <div><span style="color: #1cc88a; font-weight: 600;">Old Testament:</span> 35%</div>
  `;
  
  // Populate top chapters
  const topChaptersList = document.getElementById('topChaptersList');
  if (topChaptersList) {
    topChaptersList.innerHTML = '';
    topChapters.forEach(chapter => {
      const item = document.createElement('div');
      item.className = 'reference-item';
      item.innerHTML = `
        <span class="reference-name">${chapter.name}</span>
        <span class="reference-count">${chapter.count}</span>
      `;
      
      // Add click event to view details
      item.addEventListener('click', () => {
        window.location.href = `reference-viewer.html?reference=${encodeURIComponent(chapter.name)}`;
      });
      
      topChaptersList.appendChild(item);
    });
  }
  
  // Populate data table
  const bookDataTableBody = document.getElementById('bookDataTableBody');
  if (bookDataTableBody) {
    bookDataTableBody.innerHTML = '';
    booksData.labels.forEach((book, index) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${book}</td>
        <td>${booksData.values[index]}</td>
        <td><a href="reference-viewer.html?book=${encodeURIComponent(book)}" class="table-action">View Details</a></td>
      `;
      bookDataTableBody.appendChild(row);
    });
  }
  
  // Create Bible References Chart
  const bibleReferencesChart = document.getElementById('bibleReferencesChart');
  if (bibleReferencesChart) {
    new Chart(bibleReferencesChart, {
      type: 'bar',
      data: {
        labels: booksData.labels,
        datasets: [{
          label: 'References',
          data: booksData.values,
          backgroundColor: 'rgba(46, 163, 242, 0.7)',
          borderColor: 'rgba(46, 163, 242, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            titleFont: {
              size: 14,
              weight: 'bold'
            },
            bodyFont: {
              size: 13
            },
            padding: 10,
            cornerRadius: 4
          }
        },
        scales: {
          x: {
            grid: {
              display: false
            }
          },
          y: {
            beginAtZero: true,
            grid: {
              color: 'rgba(0, 0, 0, 0.05)'
            }
          }
        },
        onClick: (event, elements) => {
          if (elements.length > 0) {
            const index = elements[0].index;
            const book = booksData.labels[index];
            window.location.href = `reference-viewer.html?book=${encodeURIComponent(book)}`;
          }
        }
      }
    });
  }
  
  // Create Testament Chart
  const testamentChart = document.getElementById('testamentChart');
  if (testamentChart) {
    new Chart(testamentChart, {
      type: 'doughnut',
      data: {
        labels: testamentData.labels,
        datasets: [{
          data: testamentData.values,
          backgroundColor: [
            'rgba(78, 115, 223, 0.8)',
            'rgba(28, 200, 138, 0.8)'
          ],
          borderColor: [
            'rgba(78, 115, 223, 1)',
            'rgba(28, 200, 138, 1)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              padding: 20,
              font: {
                size: 12
              }
            }
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            titleFont: {
              size: 14,
              weight: 'bold'
            },
            bodyFont: {
              size: 13
            },
            padding: 10,
            cornerRadius: 4
          }
        },
        cutout: '70%'
      }
    });
  }
}
</script>